{
  "openapi": "3.1.0",
  "info": {
    "title": "Affonso API",
    "description": "REST API for managing affiliates, referrals, commissions, and payouts.",
    "version": "1.0.0",
    "contact": {
      "name": "Affonso Support",
      "url": "https://affonso.io",
      "email": "support@affonso.io"
    }
  },
  "servers": [
    {
      "url": "https://api.affonso.io",
      "description": "Production"
    },
    {
      "url": "http://localhost:3000",
      "description": "Development"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Affiliates",
      "description": "Manage affiliate users"
    },
    {
      "name": "Referrals",
      "description": "Manage referrals and conversions"
    },
    {
      "name": "Clicks",
      "description": "Track click events"
    },
    {
      "name": "Commissions",
      "description": "Manage commission transactions"
    },
    {
      "name": "Payouts",
      "description": "Manage affiliate payouts"
    }
  ],
  "paths": {
    "/v1/affiliates": {
      "get": {
        "tags": ["Affiliates"],
        "summary": "List affiliates",
        "description": "Get a paginated list of all affiliates with optional filtering and expansion",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 50,
              "maximum": 200
            }
          },
          {
            "name": "partnership_status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "approved", "rejected"],
              "nullable": true
            },
            "description": "Filter by partnership approval status"
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string",
              "maxLength": 100
            },
            "description": "Search by name, email, or tracking ID"
          },
          {
            "name": "group_id",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by affiliate group"
          },
          {
            "name": "program_id",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by specific program (defaults to team's program)"
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string",
              "pattern": "^(createdAt|updatedAt|name|partnershipStatus):(asc|desc)$",
              "example": "createdAt:desc"
            },
            "description": "Sort results by field and direction"
          },
          {
            "name": "expand",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "promoCodes,commissionOverrides"
            },
            "description": "Comma-separated list of fields to expand: promoCodes, commissionOverrides, invoiceDetails, payoutMethod"
          },
          {
            "name": "createdGte",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "createdLte",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of affiliates",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Affiliate"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "429": {
            "$ref": "#/components/responses/RateLimitExceeded"
          }
        }
      },
      "post": {
        "tags": ["Affiliates"],
        "summary": "Create affiliate",
        "description": "Create a new affiliate user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateAffiliateInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Affiliate created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Affiliate"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "409": {
            "$ref": "#/components/responses/DuplicateError"
          }
        }
      }
    },
    "/v1/affiliates/{id}": {
      "get": {
        "tags": ["Affiliates"],
        "summary": "Get affiliate",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "expand",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "promoCodes,payoutMethod"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Affiliate details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Affiliate"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": ["Affiliates"],
        "summary": "Update affiliate",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateAffiliateInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Affiliate updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Affiliate"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "delete": {
        "tags": ["Affiliates"],
        "summary": "Delete affiliate",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Affiliate deleted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "deleted": {
                          "type": "boolean",
                          "example": true
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/v1/referrals": {
      "get": {
        "tags": ["Referrals"],
        "summary": "List referrals",
        "description": "Get referrals with cursor-based pagination (excludes CLICKs)",
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10,
              "minimum": 1,
              "maximum": 100
            }
          },
          {
            "name": "starting_after",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Cursor for forward pagination"
          },
          {
            "name": "ending_before",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Cursor for backward pagination"
          },
          {
            "name": "affiliate_id",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "order",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["asc", "desc"],
              "default": "desc"
            }
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["lead", "trialing", "customer", "active", "canceled", "rejected"]
            }
          },
          {
            "name": "expand",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "affiliate"
            },
            "description": "Comma-separated list: affiliate"
          },
          {
            "name": "created_gte",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "created_lte",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of referrals",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Referral"
                      }
                    },
                    "has_more": {
                      "type": "boolean",
                      "description": "True if more results are available"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Referrals"],
        "summary": "Create referral",
        "description": "Create a new referral or convert a click to referral",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateReferralInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Referral created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Referral"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "409": {
            "$ref": "#/components/responses/DuplicateError"
          }
        }
      }
    },
    "/v1/referrals/{id}": {
      "get": {
        "tags": ["Referrals"],
        "summary": "Get referral",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "expand",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "affiliate"
            }
          },
          {
            "name": "include",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "stats"
            },
            "description": "Comma-separated list: stats"
          }
        ],
        "responses": {
          "200": {
            "description": "Referral details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Referral"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": ["Referrals"],
        "summary": "Update referral",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateReferralInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Referral updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Referral"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Referrals"],
        "summary": "Delete referral",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Referral deleted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "deleted": {
                          "type": "boolean",
                          "example": true
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/clicks": {
      "post": {
        "tags": ["Clicks"],
        "summary": "Track click",
        "description": "Record a click event for affiliate tracking",
        "responses": {
          "201": {
            "description": "Click recorded"
          }
        }
      }
    },
    "/v1/commissions": {
      "get": {
        "tags": ["Commissions"],
        "summary": "List commissions",
        "description": "Get a paginated list of all commissions with optional filtering and expansion",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 50,
              "maximum": 200
            }
          },
          {
            "name": "affiliate_id",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by affiliate ID"
          },
          {
            "name": "referral_id",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Filter by referral ID"
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["pending", "pending_manual_approval", "ready_for_payment", "paid", "declined"]
            },
            "description": "Filter by commission status"
          },
          {
            "name": "sales_status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["open", "complete", "trialing", "failed", "refunded", "partial_refunded"]
            },
            "description": "Filter by sales/transaction status"
          },
          {
            "name": "expand",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "affiliate,referral"
            },
            "description": "Expand related resources. Multiple values can be comma-separated (e.g., expand=affiliate,referral). Available: affiliate, affiliate_program, referral"
          },
          {
            "name": "created_gte",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter by created date (greater than or equal)"
          },
          {
            "name": "created_lte",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "Filter by created date (less than or equal)"
          }
        ],
        "responses": {
          "200": {
            "description": "List of commissions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Commission"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "429": {
            "$ref": "#/components/responses/RateLimitExceeded"
          }
        }
      },
      "post": {
        "tags": ["Commissions"],
        "summary": "Create commission",
        "description": "Create a new commission transaction",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCommissionInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Commission created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Commission"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/ValidationError"
          },
          "409": {
            "$ref": "#/components/responses/DuplicateError"
          }
        }
      }
    },
    "/v1/commissions/{id}": {
      "get": {
        "tags": ["Commissions"],
        "summary": "Get commission",
        "description": "Get a single commission by ID",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "expand",
            "in": "query",
            "schema": {
              "type": "string",
              "example": "affiliate,referral"
            },
            "description": "Expand related resources. Multiple values can be comma-separated (e.g., expand=affiliate,referral). Available: affiliate, affiliate_program, referral"
          }
        ],
        "responses": {
          "200": {
            "description": "Commission details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Commission"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      },
      "put": {
        "tags": ["Commissions"],
        "summary": "Update commission",
        "description": "Update a commission transaction",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCommissionInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Commission updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/Commission"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/v1/payouts": {
      "get": {
        "tags": ["Payouts"],
        "summary": "List payouts",
        "responses": {
          "200": {
            "description": "List of payouts"
          }
        }
      }
    },
    "/v1/payouts/{id}": {
      "get": {
        "tags": ["Payouts"],
        "summary": "Get payout",
        "responses": {
          "200": {
            "description": "Payout details"
          }
        }
      },
      "put": {
        "tags": ["Payouts"],
        "summary": "Update payout status",
        "responses": {
          "200": {
            "description": "Payout updated"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "API Key",
        "description": "API key authentication. Use your API key as the bearer token."
      }
    },
    "schemas": {
      "Affiliate": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string",
            "nullable": true
          },
          "email": {
            "type": "string",
            "format": "email",
            "nullable": true
          },
          "tracking_id": {
            "type": "string",
            "nullable": true
          },
          "source": {
            "type": "string",
            "nullable": true
          },
          "partnership_status": {
            "type": "string",
            "enum": ["PENDING", "APPROVED", "REJECTED"],
            "nullable": true
          },
          "onboarding_completed": {
            "type": "boolean"
          },
          "program_id": {
            "type": "string",
            "nullable": true
          },
          "group_id": {
            "type": "string",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "promo_codes": {
            "type": "array",
            "description": "Only present when expand=promoCodes",
            "items": {
              "$ref": "#/components/schemas/PromoCode"
            }
          },
          "commission_overrides": {
            "type": "array",
            "description": "Only present when expand=commissionOverrides",
            "items": {
              "$ref": "#/components/schemas/CommissionOverride"
            }
          },
          "invoice_details": {
            "$ref": "#/components/schemas/InvoiceDetails",
            "description": "Only present when expand=invoiceDetails"
          },
          "payout_method": {
            "$ref": "#/components/schemas/PayoutMethod",
            "description": "Only present when expand=payoutMethod"
          }
        }
      },
      "PromoCode": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "promo_code_id": {
            "type": "string",
            "nullable": true
          },
          "coupon_id": {
            "type": "string",
            "nullable": true
          },
          "discount_type": {
            "type": "string",
            "nullable": true
          },
          "discount_value": {
            "type": "number",
            "nullable": true
          },
          "duration": {
            "type": "string",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CommissionOverride": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "incentive_id": {
            "type": "string"
          },
          "incentive_name": {
            "type": "string"
          },
          "incentive_type": {
            "type": "string"
          },
          "amount": {
            "type": "number"
          },
          "is_percentage": {
            "type": "boolean"
          },
          "apply_to": {
            "type": "string"
          },
          "product_ids": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "InvoiceDetails": {
        "type": "object",
        "properties": {
          "company_name": {
            "type": "string",
            "nullable": true
          },
          "first_name": {
            "type": "string"
          },
          "last_name": {
            "type": "string"
          },
          "address_line_1": {
            "type": "string"
          },
          "address_line_2": {
            "type": "string",
            "nullable": true
          },
          "city": {
            "type": "string"
          },
          "postal_code": {
            "type": "string",
            "nullable": true
          },
          "state": {
            "type": "string",
            "nullable": true
          },
          "country": {
            "type": "string"
          },
          "vat_id": {
            "type": "string",
            "nullable": true
          },
          "tax_id": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "PayoutMethod": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string"
          },
          "details": {
            "type": "object",
            "additionalProperties": {
              "type": "string",
              "nullable": true
            },
            "description": "Keys use snake_case: account_id, bank_name, account_number, etc."
          }
        }
      },
      "CreateAffiliateInput": {
        "type": "object",
        "required": ["name", "email", "program_id"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Affiliate name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Affiliate email address"
          },
          "program_id": {
            "type": "string",
            "description": "Program ID to associate affiliate with"
          },
          "group_id": {
            "type": "string",
            "description": "Optional affiliate group ID"
          },
          "company_name": {
            "type": "string",
            "maxLength": 100,
            "description": "Company name for invoice"
          },
          "country_code": {
            "type": "string",
            "minLength": 2,
            "maxLength": 2,
            "description": "2-letter ISO country code"
          },
          "payout_method": {
            "type": "string",
            "enum": [
              "paypal",
              "wise",
              "payoneer",
              "paxum",
              "webmoney",
              "skrill",
              "wire_transfer",
              "bitcoin",
              "ethereum",
              "alipay",
              "wechat",
              "manual",
              "none"
            ],
            "description": "Payout method (lowercase with underscores)"
          },
          "payout_details": {
            "type": "object",
            "description": "Payout details (fields vary by method, all snake_case)",
            "properties": {
              "email": {
                "type": "string",
                "format": "email"
              },
              "account_id": {
                "type": "string"
              },
              "address": {
                "type": "string"
              },
              "bank_name": {
                "type": "string"
              },
              "account_number": {
                "type": "string"
              },
              "swift_code": {
                "type": "string"
              },
              "iban": {
                "type": "string"
              },
              "routing_number": {
                "type": "string"
              },
              "account_name": {
                "type": "string"
              }
            }
          }
        }
      },
      "UpdateAffiliateInput": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Affiliate name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Affiliate email address"
          },
          "group_id": {
            "type": "string",
            "nullable": true,
            "description": "Affiliate group ID (null to remove)"
          },
          "company_name": {
            "type": "string",
            "maxLength": 100,
            "nullable": true,
            "description": "Company name for invoice"
          },
          "country_code": {
            "type": "string",
            "minLength": 2,
            "maxLength": 2,
            "nullable": true,
            "description": "2-letter ISO country code"
          },
          "payout_method": {
            "type": "string",
            "enum": [
              "paypal",
              "wise",
              "payoneer",
              "paxum",
              "webmoney",
              "skrill",
              "wire_transfer",
              "bitcoin",
              "ethereum",
              "alipay",
              "wechat",
              "manual",
              "none"
            ],
            "description": "Payout method (none to remove)"
          },
          "payout_details": {
            "type": "object",
            "description": "Payout details (snake_case fields)"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "approved", "rejected"],
            "description": "Partnership approval status"
          }
        }
      },
      "Referral": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "affiliate_id": {
            "type": "string"
          },
          "program_id": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email",
            "nullable": true
          },
          "customer_id": {
            "type": "string",
            "nullable": true
          },
          "subscription_id": {
            "type": "string",
            "nullable": true
          },
          "status": {
            "type": "string",
            "enum": ["lead", "trialing", "customer", "active", "canceled", "rejected"]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "converted_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "affiliate": {
            "$ref": "#/components/schemas/Affiliate",
            "description": "Only present when expand=affiliate"
          },
          "stats": {
            "$ref": "#/components/schemas/ReferralStats",
            "description": "Only present when include=stats"
          }
        }
      },
      "ReferralStats": {
        "type": "object",
        "properties": {
          "total_revenue": {
            "type": "number"
          },
          "total_commission": {
            "type": "number"
          },
          "total_orders": {
            "type": "integer"
          },
          "last_order_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        }
      },
      "CreateReferralInput": {
        "type": "object",
        "required": ["email", "affiliate_id"],
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "affiliate_id": {
            "type": "string"
          },
          "subscription_id": {
            "type": "string"
          },
          "customer_id": {
            "type": "string"
          },
          "click_id": {
            "type": "string",
            "description": "If provided, converts existing CLICK to referral instead of creating new"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Allows backdating the referral"
          },
          "status": {
            "type": "string",
            "enum": ["lead", "trialing", "customer", "active", "canceled", "rejected"],
            "default": "lead"
          }
        }
      },
      "UpdateReferralInput": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "subscription_id": {
            "type": "string"
          },
          "customer_id": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["lead", "trialing", "customer", "active", "canceled", "rejected"]
          }
        }
      },
      "Commission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "referral_id": {
            "type": "string"
          },
          "affiliate_id": {
            "type": "string"
          },
          "program_id": {
            "type": "string"
          },
          "amount": {
            "type": "number",
            "description": "Transaction amount"
          },
          "amount_currency": {
            "type": "string",
            "description": "Currency code (e.g., USD, EUR)"
          },
          "commission_amount": {
            "type": "number",
            "description": "Commission amount earned"
          },
          "commission_currency": {
            "type": "string",
            "description": "Commission currency code"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "pending_manual_approval", "ready_for_payment", "paid", "declined"],
            "description": "Commission status: pending (on hold period, auto-updates to ready_for_payment when period expires), pending_manual_approval (same as pending but requires manual approval), ready_for_payment (approved and ready for payout in next cycle, not yet paid), paid (confirmed and already paid out), declined (rejected, not paid and excluded from payouts)"
          },
          "sales_status": {
            "type": "string",
            "enum": ["open", "complete", "trialing", "failed", "refunded", "partial_refunded"],
            "description": "Sales/transaction status: open (sale is open/pending), complete (sale completed successfully), trialing (customer is in trial period), failed (sale failed), refunded (sale fully refunded), partial_refunded (sale partially refunded)"
          },
          "hold_period_days": {
            "type": "integer",
            "nullable": true,
            "description": "Number of days commission is on hold before becoming available for payment"
          },
          "payment_intent_id": {
            "type": "string",
            "nullable": true,
            "description": "External payment intent ID"
          },
          "invoice_id": {
            "type": "string",
            "nullable": true,
            "description": "External invoice ID"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "affiliate": {
            "$ref": "#/components/schemas/Affiliate",
            "description": "Only present when expand=affiliate"
          },
          "affiliate_program": {
            "$ref": "#/components/schemas/AffiliateProgram",
            "description": "Only present when expand=affiliate_program"
          },
          "referral": {
            "$ref": "#/components/schemas/Referral",
            "description": "Only present when expand=referral"
          }
        }
      },
      "AffiliateProgram": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "commission_type": {
            "type": "string"
          },
          "commission_value": {
            "type": "number"
          }
        }
      },
      "CreateCommissionInput": {
        "type": "object",
        "required": ["referral_id", "amount", "commission_amount"],
        "properties": {
          "referral_id": {
            "type": "string",
            "description": "ID of the referral this commission belongs to"
          },
          "amount": {
            "type": "number",
            "description": "Transaction amount"
          },
          "amount_currency": {
            "type": "string",
            "default": "USD",
            "description": "Currency code (3 letters)"
          },
          "commission_amount": {
            "type": "number",
            "description": "Commission amount earned"
          },
          "commission_currency": {
            "type": "string",
            "default": "USD",
            "description": "Currency code (3 letters)"
          },
          "is_subscription": {
            "type": "boolean",
            "default": false,
            "description": "Whether this commission is from a subscription"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "pending_manual_approval", "ready_for_payment", "paid", "declined"],
            "default": "pending",
            "description": "Commission status"
          },
          "sales_status": {
            "type": "string",
            "enum": ["open", "complete", "trialing", "failed", "refunded", "partial_refunded"],
            "default": "complete",
            "description": "Status of the customer's purchase"
          },
          "payment_intent_id": {
            "type": "string",
            "nullable": true,
            "description": "Payment provider's intent ID"
          },
          "hold_period_days": {
            "type": "integer",
            "minimum": 0,
            "nullable": true,
            "description": "Number of days to hold commission before it's ready for payment"
          }
        }
      },
      "UpdateCommissionInput": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["pending", "pending_manual_approval", "ready_for_payment", "paid", "declined"],
            "description": "Commission status"
          },
          "sales_status": {
            "type": "string",
            "enum": ["open", "complete", "trialing", "failed", "refunded", "partial_refunded"],
            "description": "Status of the customer's purchase"
          },
          "hold_period_days": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of days to hold commission before it's ready for payment"
          }
        }
      },
      "PaginationMeta": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "total": {
            "type": "integer"
          },
          "total_pages": {
            "type": "integer"
          },
          "has_next_page": {
            "type": "boolean"
          },
          "has_prev_page": {
            "type": "boolean"
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "field": {
                "type": "string",
                "description": "Optional field name for validation errors"
              }
            }
          }
        }
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "Missing or invalid API key",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "success": false,
              "error": {
                "code": "UNAUTHORIZED",
                "message": "Invalid API key"
              }
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "success": false,
              "error": {
                "code": "NOT_FOUND",
                "message": "Resource not found"
              }
            }
          }
        }
      },
      "ValidationError": {
        "description": "Validation error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "success": false,
              "error": {
                "code": "VALIDATION_ERROR",
                "message": "Valid email is required",
                "field": "email"
              }
            }
          }
        }
      },
      "DuplicateError": {
        "description": "Duplicate resource",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "success": false,
              "error": {
                "code": "DUPLICATE_ERROR",
                "message": "Resource with this identifier already exists"
              }
            }
          }
        }
      },
      "RateLimitExceeded": {
        "description": "Rate limit exceeded",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "success": false,
              "error": {
                "code": "RATE_LIMIT_EXCEEDED",
                "message": "Rate limit exceeded. Please try again later."
              }
            }
          }
        }
      }
    }
  }
}
