---
title: 'Embedded Referral Dashboard'
description: 'Embed your affiliate dashboard directly into your application'
---

With Affonso, you can build an embedded referral dashboard that lives directly inside your application. Your users can automatically enroll in your partner program **without needing to leave your app**.

## How It Works

1. Your server generates a short-lived embed token via the Affonso API
2. You pass this token to an iframe that displays the referral dashboard
3. The dashboard fetches data using the token and renders the affiliate's stats

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Your App       │     │  Affonso API    │     │  Embed Page     │
│  (Server)       │────▶│  /embed/token   │────▶│  /embed/        │
│                 │     │                 │     │  referrals      │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

## Step 1: Generate Embed Token

Create a server-side API route that generates a public token. This token will be used by the embedded dashboard to fetch real-time data.

```bash cURL
curl -X POST "https://api.affonso.io/v1/embed/token" \
  -H "Authorization: Bearer sk_live_your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "programId": "your_program_id",
    "partner": {
      "email": "user@example.com",
      "name": "John Doe"
    }
  }'
```

**Response:**

```json
{
  "success": true,
  "data": {
    "publicToken": "abc123...",
    "expiresAt": "2024-01-15T10:30:00Z",
    "link": "https://yourcompany.com?via=john-doe"
  }
}
```

### Request Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `programId` | string | Yes | Your affiliate program ID |
| `partner.email` | string | Yes | User's email address |
| `partner.name` | string | No | User's display name |
| `partner.image` | string | No | User's avatar URL |
| `groupId` | string | No | Assign to specific affiliate group |

<Note>
  If the affiliate doesn't exist, they will be automatically created and approved for the program.
</Note>

## Step 2: Install the Embed

With the `publicToken` from Step 1, add an iframe to your application:

```html
<iframe
  src="https://affonso.io/embed/referrals?token=YOUR_PUBLIC_TOKEN"
  width="100%"
  height="600"
  frameborder="0"
  allow="clipboard-write"
/>
```

### Next.js Example

```tsx
// app/referrals/page.tsx
import { getEmbedToken } from '@/lib/affonso';

export default async function ReferralsPage() {
  const user = await getCurrentUser();

  const { publicToken } = await getEmbedToken({
    programId: process.env.AFFONSO_PROGRAM_ID!,
    partner: {
      email: user.email,
      name: user.name,
    },
  });

  return (
    <iframe
      src={`https://affonso.io/embed/referrals?token=${publicToken}`}
      className="w-full h-screen border-0"
      allow="clipboard-write"
    />
  );
}
```

```typescript
// lib/affonso.ts
export async function getEmbedToken(params: {
  programId: string;
  partner: { email: string; name?: string; image?: string };
  groupId?: string;
}) {
  const response = await fetch('https://api.affonso.io/v1/embed/token', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.AFFONSO_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(params),
  });

  const { data } = await response.json();
  return data;
}
```

## Token Details

| Property | Value |
|----------|-------|
| **TTL** | 30 minutes |
| **Auto-create** | Affiliate is created if not exists |
| **Partnership** | Auto-approved for the program |
| **Group** | Uses default group or custom `groupId` |

<Warning>
  Generate a new token on each page load. Do not cache tokens long-term.
</Warning>

## Dashboard Features

The embedded dashboard includes:

- **Referral Link** - Copy-to-clipboard functionality
- **Performance Stats** - Clicks, leads, sales, and earnings
- **Earnings Table** - Recent transactions with status
- **Coupon Code** - Display and self-service creation (if enabled)
- **Resources** - Marketing creatives and assets
- **Settings Link** - Direct access to full affiliate portal

## Theming

The embed automatically uses your program's brand colors from Portal Settings:

- **Primary Color** - Buttons and accents
- **Secondary Color** - Highlights

Colors must be valid HEX format (e.g., `#881337`).

## Security

- Always generate tokens **server-side** to protect your API key
- Tokens are scoped to specific affiliates and programs
- Expired tokens are automatically invalidated
